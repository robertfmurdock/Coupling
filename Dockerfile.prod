FROM node:14.8-alpine

WORKDIR /usr/src/app/server

ENV \
  PUBLIC_HOST=web \
  NODE_ENV=production \
  NODE_PATH=/usr/src/app/server/build/node_modules:/usr/src/app/server/build/packages:/usr/src/app/server/build/packages_imported

COPY build/js/packages /usr/src/app/server/build/packages
COPY build/js/packages_imported /usr/src/app/server/build/packages_imported

COPY server/package.json /usr/src/app/server/
RUN yarn install --production

COPY server/startup.js /usr/src/app/server
COPY server/build/executable /usr/src/app/server/build/executable

ARG ASSETS_PATH /unset
ENV CLIENT_PATH $ASSETS_PATH

CMD ["node", "./startup.js"]
EXPOSE 3000 8125
